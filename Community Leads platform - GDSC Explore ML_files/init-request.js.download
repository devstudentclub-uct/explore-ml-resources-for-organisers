!function(e){function t(s){if(n[s])return n[s].exports;var r=n[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,s){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:s})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(t.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(s,r,function(t){return e[t]}.bind(null,r));return s},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="https://prod.cdn.lumapps.com/a5a6f177b6/",t(t.s=3015)}({3015:function(e,t,n){"use strict";function s(){return window.localStorage&&window.localStorage.getItem&&window.localStorage.setItem}function r(e){var t=new XMLHttpRequest;return t.open("GET","/service/init?".concat(e)),t.setRequestHeader("Content-type","application/json"),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Lumapps-Organization-Id",window.CUSTOMER_ID),t.send({}),t}n.r(t);var i=console,o=i.debug,a="serviceInitCache",u=function(e){this.queryParams=e,this.readyState=void 0,this.responseText=void 0,this.responseJson=void 0,this.status=void 0,this.createdAt=new Date,this.listeners={};var t=this;this.fetch=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=r(this.queryParams);n.onload=function(){4===n.readyState&&(e?t.saveInCacheSetResultAndDispatch({readyState:n.readyState,status:n.status,responseText:n.responseText,responseJson:200===n.status?JSON.parse(n.responseText):void 0}):t.saveInCache({readyState:n.readyState,status:n.status,responseText:n.responseText,responseJson:200===n.status?JSON.parse(n.responseText):void 0}))}},this.updateToken=function(e){var t=this,n=e.responseJson,s=n.customer.id,r=new XMLHttpRequest;r.open("POST","/service/user/token"),r.setRequestHeader("Content-type","application/json"),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Lumapps-Organization-Id",window.CUSTOMER_ID),r.onload=function(){if(4===r.readyState)if(200===r.status){var s=JSON.parse(r.responseText);s.status?(n.token=s.token,o("service init token updated ".concat(new Date-t.createdAt," ms")),t.setResultAndDispatch({readyState:e.readyState,status:e.status,responseText:JSON.stringify(n),responseJson:n}),t.fetch(!1)):t.fetch()}else t.fetch()},r.send(JSON.stringify({customerId:s}))},this.setResultAndDispatch=function(e){this.readyState=e.readyState,this.status=e.status,this.responseText=e.responseText,this.responseJson=e.responseJson,this.dispatchEvent({type:"load"}),o("service init dispatched within ".concat(new Date-this.createdAt," ms"))},this.saveInCache=function(e){s()&&function(e){return e&&200===e.status}(e)&&window.localStorage.setItem(a,JSON.stringify({queryParams:this.queryParams,result:{readyState:e.readyState,status:e.status,responseText:e.responseText,responseJson:e.responseJson}}))},this.saveInCacheSetResultAndDispatch=function(e){this.setResultAndDispatch(e),this.saveInCache(e)},this.getFromCache=function(){if(s()){var e=window.localStorage.getItem(a);if(e){var t=JSON.parse(e);if(t.queryParams===this.queryParams)return t.result&&!t.result.responseJson&&(t.result.responseJson=JSON.parse(t.result.responseText)),t.result}}},this.addEventListener=function(e,t){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)},this.removeEventListener=function(e,t){if(e in this.listeners)for(var n=this.listeners[e],s=0,r=n.length;s<r;s++)if(n[s]===t)return void n.splice(s,1)},this.dispatchEvent=function(e){if(!(e.type in this.listeners))return!0;for(var t=this.listeners[e.type].slice(),n=0,s=t.length;n<s;n++)t[n].call(this,e);return!e.defaultPrevented};var n=this.getFromCache();if(s()&&window.localStorage.removeItem(a),!n)return o("service init not retrieved from cache, fetch it now"),void this.fetch();this.updateToken(n)};!function(){function e(){var e={},t=(window.location.search||"").replace("?","").split("&")||[];return t.forEach((function(t){var n=t.split("=");n&&0!==n.length&&(1===n.length&&(n[1]=void 0),e[n[0]]=n[1])})),e}function t(){var t=i?a[1]:a[3];if("gsite"!==t)return t;var n=e();if(!n.parent)return t;var s=decodeURIComponent(n.parent).split("/")||[];return s.length<6?t:(s=s[5],s=(s.split("?")||[s])[0],(s.split("#")||[s])[0])}function n(e){var t;if(c){var n=a.indexOf(e);if("ls"===a[n+1])t=n+2;else{var s=a.indexOf("community");t=-1!==s?s:a.indexOf("group")}}return c?a[t+1]:a[a.length-1]}var s,r,i=-1===window.location.pathname.indexOf("/a/"),o=window.location.pathname,a=o.split("/")||(i?["","",""]:["","a","",""]),c=-1!==o.indexOf("/ls/community/")||-1!==o.indexOf("/ls/group/"),d=i?window.location.host:a[2],p=t(),l=function(){var s=t(),r=e();if(!r.parent)return n(s);var i=decodeURIComponent(r.parent).split("?")||[];if(i.length<2)return n(s);i=i[1];var o=i.split("&");if(0===o.length)return n(s);for(var a=0;a<o.length;a++){var u=o[a].split("=");if(!(u.length<2)&&"s"===u[0])return u[1]}return n(s)}(),f=i?"customerHost":"customerSlug",h=(s=p,r=ROUTES_TO_FETCH_ASYNCHRONOUSLY.filter((function(e){return-1!==o.indexOf(s+e)})),r.length>0?"contentId":"slug"),v={instanceSlug:p,loadInstance:!("login"===p&&"account"===l||"admin"===p&&"customer"===l)};v[f]=d,v[h]=l;var g,m=Object.keys(v).map((function(e){return"".concat(e,"=").concat(v[e])})).join("&"),S=(g=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),g?parseInt(g[2],10):0),w=S&&S<70,y=-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>-1;y||/Edge?\/(?:[0-6][0-9]|[0-7][0-8])/i.test(navigator.userAgent)||w||"True"===HAS_DISABLED_FRONTEND_CACHE?(window.initRequest=new XMLHttpRequest,window.initRequest.open("GET","/service/init?".concat(m)),window.initRequest.send()):window.initRequest=new u(m)}()}});
//# sourceMappingURL=init-request.js.map